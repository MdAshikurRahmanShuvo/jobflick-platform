{% extends "userprofile/layout.html" %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="h4 mb-0">Job Applications</h2>
    <p class="text-muted mb-0">Review and approve candidates for posted jobs.</p>
  </div>
</div>

<div class="table-responsive bg-white shadow-sm rounded">
  <table class="table mb-0 align-middle">
    <thead class="table-light">
      <tr>
        <th scope="col">Job</th>
        <th scope="col">Applicant</th>
        <th scope="col">Submitted</th>
        <th scope="col">Status</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for application in applications %}
      <tr>
        <td>
          <div class="fw-semibold">{{ application.job.work_title }}</div>
          <small class="text-muted">{{ application.job.tracking_code }}</small>
          {% if application.job.is_filled %}
            <div><span class="badge badge-dark mt-2">Hiring completed</span></div>
          {% endif %}
        </td>
        <td>
          <div>{{ application.applicant.username }}</div>
          <small class="text-muted">{{ application.applicant.email }}</small>
        </td>
        <td>{{ application.created_at|date:"M d, Y h:i A" }}</td>
        <td>
          {% if application.status == 'approved' %}
            <span class="badge badge-success">Approved</span>
          {% elif application.status == 'pending' %}
            <span class="badge badge-warning text-dark">Pending</span>
          {% else %}
            <span class="badge badge-danger">Rejected</span>
          {% endif %}
        </td>
        <td>
          {% if application.status == 'pending' %}
            {% if application.job.is_filled %}
              <span class="badge badge-secondary">Closed</span>
            {% else %}
              <div class="d-flex align-items-center">
                <form class="mr-2" method="post" action="{% url 'update_application_status' application.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="approve">
                  <button class="btn btn-success btn-sm" type="submit">Approve</button>
                </form>
                <form method="post" action="{% url 'update_application_status' application.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="reject">
                  <button class="btn btn-outline-danger btn-sm" type="submit">Reject</button>
                </form>
              </div>
            {% endif %}
          {% else %}
            <small class="text-muted">Updated {{ application.decision_at|timesince }} ago</small>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-4 text-muted">No applications available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
