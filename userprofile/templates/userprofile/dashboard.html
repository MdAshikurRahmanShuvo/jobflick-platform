{% extends "userprofile/layout.html" %}
{% load static %}

{% block dashboard_content %}
{% include "jobs/_apply_jobs_section.html" with jobs=jobs apply_profile=profile apply_redirect_path=request.path %}

{% if my_live_jobs %}
  <section class="mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 class="h5 mb-0">Your live job posts</h2>
        <p class="text-muted mb-0">Published listings that candidates can still apply to.</p>
      </div>
      <span class="badge badge-light text-dark">{{ my_live_jobs|length }} live</span>
    </div>
    <div class="row">
      {% for job in my_live_jobs %}
        <div class="col-md-6 mb-3">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="mb-0">{{ job.work_title }}</h5>
                <span class="badge badge-light text-dark">{{ job.tracking_code }}</span>
              </div>
              {% if job.is_filled %}
                <div class="mb-2"><span class="badge badge-dark">Hiring completed</span></div>
              {% endif %}
              <p class="text-muted small mb-1"><strong>Location:</strong> {{ job.location }}</p>
              <p class="text-muted small mb-1"><strong>Duration:</strong> {{ job.duration }}</p>
              <p class="text-muted small mb-1"><strong>Budget:</strong> {{ job.amount }} BDT</p>
              <p class="text-muted small mb-0"><strong>Skills:</strong> {{ job.skills }}</p>
            </div>
            <div class="card-footer bg-white d-flex justify-content-between align-items-center">
              <small class="text-muted">Posted {{ job.created_at|timesince }} ago</small>
              {% if job.is_filled %}
                <span class="badge badge-dark">Closed</span>
              {% else %}
                <span class="badge badge-success">Live</span>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>
{% endif %}

{% if pending_jobs %}
  <div class="card shadow-sm border-0 mt-5">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-0">Awaiting admin review</h5>
        <small class="text-muted">We'll publish these once an admin approves them.</small>
      </div>
      <span class="badge badge-warning text-dark">{{ pending_jobs|length }} pending</span>
    </div>
    <div class="table-responsive">
      <table class="table mb-0">
        <thead class="thead-light">
          <tr>
            <th>Title</th>
            <th class="d-none d-md-table-cell">Tracking</th>
            <th>Status</th>
            <th class="d-none d-md-table-cell">Submitted</th>
          </tr>
        </thead>
        <tbody>
          {% for job in pending_jobs %}
          <tr>
            <td>
              <div class="font-weight-semibold">{{ job.work_title }}</div>
              <small class="text-muted">{{ job.location }} â€¢ {{ job.duration }}</small>
            </td>
            <td class="d-none d-md-table-cell text-muted">{{ job.tracking_code }}</td>
            <td>
              {% if job.status == 'approved' %}
                <span class="badge badge-success">Live</span>
              {% else %}
                <span class="badge badge-warning text-dark">Pending</span>
              {% endif %}
            </td>
            <td class="d-none d-md-table-cell text-muted">{{ job.created_at|date:"M d, Y h:i A" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}
{% endblock %}
