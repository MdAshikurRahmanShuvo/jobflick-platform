{% extends "base.html" %}

{% block content %}
<style>
  body {
    background: #eef2fb;
  }
  .dashboard-shell-wrapper {
    position: relative;
    padding-left: 3rem;
  }
  .dashboard-shell {
    display: flex;
    min-height: calc(100vh - 40px);
    position: relative;
    overflow: visible;
    background: #fff;
    border-radius: 0;
    border: 1px solid rgba(14, 23, 41, 0.05);
    box-shadow: 0 35px 60px rgba(15, 39, 90, 0.08);
  }
  .sidebar {
    width: 310px;
    background: linear-gradient(180deg, #071939 0%, #0f2b57 65%, #0b193a 100%);
    color: #dce4ff;
    transition: transform 0.35s ease;
    z-index: 1040;
    overflow-y: auto;
    position: fixed;
    top: 0;
    bottom: 0;
    left: -330px;
    transform: translateX(0);
    display: flex;
    flex-direction: column;
    box-shadow: 0 1.5rem 3rem rgba(8, 17, 37, 0.5);
  }
  .sidebar h3 {
    padding: 1.75rem 2rem 1.25rem;
    margin: 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    font-size: 1.05rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 600;
  }
  .sidebar nav {
    display: flex;
    flex-direction: column;
    padding: 0.5rem 0 2rem;
    gap: 0.35rem;
  }
  .sidebar nav a {
    display: flex;
    align-items: center;
    gap: 0.55rem;
    padding: 0.85rem 2rem;
    color: rgba(236,240,255,0.85);
    text-decoration: none;
    font-size: 0.95rem;
    border-left: 3px solid transparent;
    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }
  .sidebar nav a::before {
    content: '•';
    font-size: 0.5rem;
    color: rgba(236,240,255,0.7);
  }
  .sidebar nav a:hover,
  .sidebar nav a:focus {
    background: rgba(255,255,255,0.06);
    color: #ffffff;
    border-left-color: #3f86ff;
  }
  .dashboard-main {
    flex: 1;
    padding: 2.5rem 3rem;
    background: #fbfcff;
  }
  .topbar {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  .toggle-btn {
    border: 1px solid rgba(19,47,98,0.25);
    background: #fff;
    color: #102b58;
    padding: 0.45rem 0.95rem;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 12px 25px rgba(16,43,88,0.08);
  }
  .menu-floating-toggle {
    position: fixed;
    top: 1.75rem;
    left: 15px;
    transform: none;
    z-index: 1050;
    transition: left 0.35s ease;
  }
  .dashboard-shell-wrapper.menu-open .menu-floating-toggle {
    left: calc(310px + 15px);
  }
  .dashboard-shell.menu-open .sidebar {
    transform: translateX(330px);
  }
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 1035;
  }
  .dashboard-shell.menu-open .sidebar-overlay {
    opacity: 1;
    pointer-events: auto;
  }
  @media (max-width: 991px) {
    .dashboard-shell {
      min-height: calc(100vh - 20px);
    }
    .dashboard-shell-wrapper {
      padding-left: 0;
    }
    .menu-floating-toggle {
      left: 1rem;
      top: 1rem;
    }
      .dashboard-main {
        padding: 1.5rem 1.25rem 2rem;
      }
  }
</style>

<div class="dashboard-shell-wrapper">
  <button class="toggle-btn menu-floating-toggle" id="menuToggle" aria-label="Toggle navigation">☰</button>
  <div class="dashboard-shell">
    <aside class="sidebar" id="dashboardSidebar">
    <h3>Jobflick Panel</h3>
    <nav>
      <a href="{% url 'user-dashboard' %}">Home</a>
      <a href="{% url 'userprofile-edit' %}">Edit Profile</a>
      <a href="{% url 'post_job' %}">Post a Job</a>
      <a href="{% url 'job_list' %}">Apply for Jobs</a>
      <a href="{% url 'userprofile-notifications' %}">Notifications
        {% if unread_notifications_count %}
          <span class="badge badge-light ml-2">{{ unread_notifications_count }}</span>
        {% endif %}
      </a>
      {% if request.user.is_staff %}
      <a href="{% url 'adminpanel-dashboard' %}">Admin Panel</a>
      {% endif %}
      <a href="{% url 'userprofile-transactions' %}">Transactions</a>
      <a href="{% url 'userprofile-chat' %}">Chat</a>
      <a href="{% url 'userprofile-activity' %}">Activity History</a>
      <a href="{% url 'userprofile-about' %}">About Us</a>
      <a href="{% url 'userprofile-contact' %}">Contact Us</a>
      <a href="{% url 'userprofile-help' %}">Help</a>
      <a href="{% url 'logout' %}">Logout</a>
    </nav>
  </aside>
    <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <section class="dashboard-main">
      <div class="topbar">
        <div class="text-end">
        <p class="text-muted small mb-0">Signed in as</p>
        <h5 class="mb-0">{{ profile.user.username }}</h5>
      </div>
    </div>

      {% block dashboard_content %}{% endblock %}
    </section>
  </div>
</div>

<script>
  (function() {
    const toggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('dashboardSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const shell = document.querySelector('.dashboard-shell');
    const wrapper = document.querySelector('.dashboard-shell-wrapper');

    const setAriaState = (isOpen) => {
      toggle?.setAttribute('aria-expanded', String(isOpen));
      sidebar?.setAttribute('aria-hidden', String(!isOpen));
    };

    const applyMenuState = (isOpen) => {
      shell?.classList.toggle('menu-open', isOpen);
      wrapper?.classList.toggle('menu-open', isOpen);
      setAriaState(isOpen);
    };

    const closeSidebar = () => {
      applyMenuState(false);
    };

    const toggleSidebar = () => {
      if (!shell) return;
      const nextState = !shell.classList.contains('menu-open');
      applyMenuState(nextState);
    };

    toggle?.addEventListener('click', toggleSidebar);
    overlay?.addEventListener('click', closeSidebar);
    document.addEventListener('keydown', (evt) => {
      if (evt.key === 'Escape' && shell?.classList.contains('menu-open')) {
        closeSidebar();
      }
    });

    setAriaState(false);
  })();
</script>
{% endblock %}
